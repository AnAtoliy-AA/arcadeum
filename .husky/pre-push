#!/usr/bin/env sh

set -e

pnpm run build

# Run backend unit tests before pushing
echo "Running backend unit tests..."
cd apps/be
pnpm run test || {
  echo "❌ Backend unit tests failed. Please fix them before pushing."
  exit 1
}
cd ../..
echo "✅ Backend unit tests passed"

# Run web unit tests before pushing
echo "Running web unit tests..."
cd apps/web
pnpm run test || {
  echo "❌ Web unit tests failed. Please fix them before pushing."
  exit 1
}
cd ../..
echo "✅ Web unit tests passed"

# Check translations
echo "Checking translations..."
node scripts/check_translation.js || {
  echo "❌ Translation validation failed. Please fix missing translation keys."
  exit 1
}

# Run web e2e tests before pushing
echo "Running e2e tests..."
cd apps/web
pnpm run test:e2e || {
  echo "❌ E2E tests failed. Please fix them before pushing."
  exit 1
}
cd ../..
echo "✅ E2E tests passed"
